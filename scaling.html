<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Efficient GPU usage &mdash; oxDNA  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="External forces" href="forces.html" />
    <link rel="prev" title="Improving performance" href="performance.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            oxDNA
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="input.html">Input file</a></li>
<li class="toctree-l1"><a class="reference internal" href="configurations.html">Configuration and topology files</a></li>
<li class="toctree-l1"><a class="reference internal" href="relaxation.html">Relaxing initial configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Improving performance</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Efficient GPU usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#simulation-performance-on-gpu-classes">Simulation performance on GPU classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#increasing-simulation-throughput-with-multi-process-service">Increasing simulation throughput with multi-process service</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="forces.html">External forces</a></li>
<li class="toctree-l1"><a class="reference internal" href="observables.html">Observables</a></li>
<li class="toctree-l1"><a class="reference internal" href="umbrella_sampling.html">Umbrella sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="ffs.html">Forward Flux Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oat/index.html">oxDNA Analysis Tools</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="oxpy/index.html">Oxpy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">oxDNA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Efficient GPU usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/scaling.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="efficient-gpu-usage">
<h1>Efficient GPU usage<a class="headerlink" href="#efficient-gpu-usage" title="Permalink to this heading"></a></h1>
<section id="simulation-performance-on-gpu-classes">
<h2>Simulation performance on GPU classes<a class="headerlink" href="#simulation-performance-on-gpu-classes" title="Permalink to this heading"></a></h2>
<p>As NVIDIA releases new GPU architectures, the performance of oxDNA generally increases.  On current hardware (June 2023), it is not uncommon to be able to run well-sampled equilibrium simulations of DNA origami structures within 1-2 days. The following graph compares the performace of NVIDIA v100 vs a100 scientific GPUs on oxDNA simulations of varying sizes.</p>
<p><img alt="" src="_images/single_process.png" /></p>
<p>This data was taken by Erik Poppleton on MPCDF Cobra (v100) and Raven (a100) in June 2023.</p>
</section>
<section id="increasing-simulation-throughput-with-multi-process-service">
<h2>Increasing simulation throughput with multi-process service<a class="headerlink" href="#increasing-simulation-throughput-with-multi-process-service" title="Permalink to this heading"></a></h2>
<p>Compared with the AI applications that modern GPUs are optimized for, oxDNA simulations use relatively little memory.  This means that you can get significance increases in simulation throughput by activating <a class="reference external" href="https://docs.nvidia.com/deploy/mps/index.html">Multi-Process Service (MPS)</a>, an alternative CUDA API which allows multiple processes to share the same GPU.  If your cluster is MPS compatible (GPUs set to EXCLUSIVE_PROCESS, preferably Volta architecture or newer), using oxDNA is as simple as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nvidia-cuda-mps-control<span class="w"> </span>-d
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>seq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="nv">$nproc</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>r<span class="nv">$i</span>
<span class="w">    </span>/u/epoppleton/software/oxDNA/build/bin/oxDNA<span class="w"> </span>input<span class="w"> </span><span class="p">&amp;</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">0</span>.25
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>..
<span class="k">done</span>
<span class="nb">wait</span>
<span class="nb">echo</span><span class="w"> </span>quit<span class="w"> </span><span class="p">|</span><span class="w"> </span>nvidia-cuda-mps-control
</pre></div>
</div>
<p>It is generally advisable to include the <code class="docutils literal notranslate"><span class="pre">sleep</span></code> between starting each oxDNA process as if they start too close together, the memory allocation on the GPU will occasionally fail.</p>
<p>The following graph compares the performance of various numbers of MPS processes on 80GB v100 and a100 GPUs with various number of processes
<img alt="" src="_images/mps.png" /></p>
<p>This data was taken by Erik Poppleton on MPCDF Cobra (v100) and Raven (a100) in June 2023.</p>
<p><strong>NOTE</strong> The largest system size (524288 nucleotides) ran out of memory after 10 processes, this is why there’s no change at 20 and 40 processes on a100s and no data on v100s.</p>
<p><strong>NOTE</strong> Some variation in the data was caused by a few jobs per-batch failing due to too many members in the neighbor list.  This can be avoided by adding the <a class="reference external" href="https://lorenzo-rovigatti.github.io/oxDNA/input.html#cuda-options">max_density_multiplier</a> argument to the input files; however this increases memory usage and may cause the MPS runs with higher numbers of replicates to fail.</p>
<p><strong>NOTE</strong> The clusters used to test here limited the number of CPUs associated with each GPU to 20 (v100) and 16 (a100), this likely impacted the simulation efficiency for large numbers of processes.</p>
<p>CSV format files for these graphs can be found here: <a class="reference download internal" download="" href="_downloads/4c7ffb97c195e5336be3690fe0620df6/v100.csv"><span class="xref download myst">v100</span></a> | <a class="reference download internal" download="" href="_downloads/a2bc27f61e5e1ee0ba0d423fedab324f/a100.csv"><span class="xref download myst">a100</span></a></p>
<p>If you would like to test this on your own cluster, the setup files can be found on <a class="reference external" href="https://github.com/ErikPoppleton/oxDNA_performance">Erik’s GitHub</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="performance.html" class="btn btn-neutral float-left" title="Improving performance" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="forces.html" class="btn btn-neutral float-right" title="External forces" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Lorenzo Rovigatti, Flavio Romano, Erik Poppleton, Michael Matthies, and Petr Šulc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>